<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberScan Pro - Advanced OSINT & Security Analysis Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #0a0e27;
            --secondary-bg: #1a1f3a;
            --accent-bg: #2d3748;
            --surface-bg: #1e2432;
            --border-color: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-blue: #4fd1c7;
            --accent-purple: #9f7aea;
            --accent-red: #fc8181;
            --accent-green: #68d391;
            --accent-yellow: #f6e05e;
            --accent-orange: #ed8936;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #4fd1c7 0%, #9f7aea 100%);
            --gradient-danger: linear-gradient(135deg, #fc8181 0%, #f56565 100%);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --sidebar-width: 280px;
            --sidebar-collapsed: 70px;
            --header-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* 레이아웃 구조 */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* 사이드바 */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--secondary-bg);
            border-right: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar.collapsed .sidebar-header {
            padding: 1.5rem 1rem;
            justify-content: center;
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            white-space: nowrap;
        }

        .sidebar.collapsed .sidebar-logo {
            display: none;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            color: var(--accent-blue);
            background: rgba(79, 209, 199, 0.1);
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 3px solid transparent;
        }

        .sidebar.collapsed .nav-item {
            padding: 0.75rem 1rem;
            justify-content: center;
        }

        .nav-item:hover {
            background: rgba(79, 209, 199, 0.1);
            border-left-color: var(--accent-blue);
        }

        .nav-item.active {
            background: rgba(79, 209, 199, 0.15);
            border-left-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .nav-item i {
            font-size: 1.2rem;
            min-width: 20px;
            text-align: center;
        }

        .nav-text {
            font-weight: 500;
            white-space: nowrap;
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed .nav-text {
            opacity: 0;
            display: none;
        }

        /* 메인 컨텐츠 */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
            background: var(--primary-bg);
        }

        .sidebar.collapsed + .main-content {
            margin-left: var(--sidebar-collapsed);
        }

        /* 헤더 */
        .main-header {
            height: var(--header-height);
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-stats {
            display: flex;
            gap: 1.5rem;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--surface-bg);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .stat-badge i {
            color: var(--accent-blue);
        }

        .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* 대시보드 컨텐츠 */
        .dashboard-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 대시보드 위젯 그리드 */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .widget-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .widget-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .widget-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-secondary);
        }

        .widget-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .widget-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .widget-title i {
            color: var(--accent-blue);
        }

        .widget-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .widget-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* 스캔 상태 카드 */
        .scan-status-card {
            grid-column: span 2;
            min-height: 200px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .status-item {
            text-align: center;
            padding: 1rem;
            background: var(--surface-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .status-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .status-running .status-icon { color: var(--accent-blue); }
        .status-completed .status-icon { color: var(--accent-green); }
        .status-error .status-icon { color: var(--accent-red); }
        .status-pending .status-icon { color: var(--accent-yellow); }

        /* 최근 스캔 리스트 */
        .recent-scans {
            max-height: 300px;
            overflow-y: auto;
        }

        .scan-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.3s ease;
        }

        .scan-item:hover {
            background: var(--surface-bg);
        }

        .scan-item:last-child {
            border-bottom: none;
        }

        .scan-info {
            flex: 1;
        }

        .scan-target {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .scan-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* 빠른 액션 버튼들 */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-btn {
            padding: 1rem;
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
            color: var(--text-primary);
        }

        .action-btn:hover {
            background: var(--accent-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            color: var(--accent-blue);
        }

        .action-btn i {
            font-size: 1.5rem;
            color: var(--accent-blue);
        }

        .action-content {
            flex: 1;
        }

        .action-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .action-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* 페이지 컨텐츠 */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* 반응형 디자인 */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }

            .scan-status-card {
                grid-column: span 1;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 0 1rem;
            }

            .header-stats {
                display: none;
            }

            .dashboard-content {
                padding: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23667eea" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat top center;
            background-size: cover;
            opacity: 0.3;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .logo i {
            font-size: 3rem;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            background: var(--gradient-secondary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 1rem;
        }

        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(79, 209, 199, 0.1);
            border: 1px solid var(--accent-blue);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: var(--accent-blue);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }


        /* Progress Bar */
        .progress-container {
            margin: 2rem 0;
            display: none;
        }

        .progress-wrapper {
            background: var(--surface-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--accent-bg);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-secondary);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .progress-text {
            font-weight: 600;
        }

        /* Results Container */
        .results-container {
            display: none;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--surface-bg);
            border-radius: 16px 16px 0 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 1.25rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-secondary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .nav-tab.active {
            color: var(--accent-blue);
            background: rgba(79, 209, 199, 0.05);
        }

        .nav-tab.active::before {
            transform: scaleX(1);
        }

        .nav-tab:hover {
            color: var(--accent-blue);
            background: rgba(79, 209, 199, 0.05);
        }

        .nav-tab i {
            font-size: 1.1rem;
        }

        /* Content Panels */
        .tab-content {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 0 0 16px 16px;
            padding: 2rem;
            min-height: 400px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Host Results */
        .host-result {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .host-result:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .host-header {
            background: var(--accent-bg);
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .host-header:hover {
            background: rgba(79, 209, 199, 0.1);
        }

        .host-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .host-ip {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .expand-icon {
            color: var(--accent-blue);
            transition: transform 0.3s ease;
        }

        .host-content {
            padding: 1.5rem;
            display: none;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .info-section {
            background: rgba(79, 209, 199, 0.05);
            border: 1px solid rgba(79, 209, 199, 0.2);
            border-radius: 8px;
            padding: 1.25rem;
        }

        .info-section h4 {
            color: var(--accent-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-section h4 i {
            font-size: 1.2rem;
        }

        .info-item {
            background: var(--secondary-bg);
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 8px;
            border-left: 4px solid var(--accent-green);
            transition: all 0.3s ease;
        }

        .info-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .info-item.critical {
            border-left-color: var(--accent-red);
            background: rgba(252, 129, 129, 0.05);
        }

        .info-item.high {
            border-left-color: var(--accent-orange);
            background: rgba(237, 137, 54, 0.05);
        }

        .info-item.medium {
            border-left-color: var(--accent-yellow);
            background: rgba(246, 224, 94, 0.05);
        }

        .info-item.low {
            border-left-color: var(--accent-green);
            background: rgba(104, 211, 145, 0.05);
        }

        /* Status Indicators */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-open {
            background: rgba(104, 211, 145, 0.2);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }

        .status-closed {
            background: rgba(252, 129, 129, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        /* Web Accessibility Info */
        .web-info {
            background: rgba(159, 122, 234, 0.1);
            border: 1px solid rgba(159, 122, 234, 0.3);
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.75rem;
            font-size: 0.875rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .scan-form {
                flex-direction: column;
                gap: 1rem;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                overflow-x: auto;
            }
            
            .nav-tab {
                min-width: 120px;
            }

        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-bg);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 209, 199, 0.8);
        }

        /* Utility Classes */
        .text-critical { color: var(--accent-red); }
        .text-high { color: var(--accent-orange); }
        .text-medium { color: var(--accent-yellow); }
        .text-low { color: var(--accent-green); }
        .text-info { color: var(--accent-blue); }

        .bg-critical { background: rgba(252, 129, 129, 0.1); }
        .bg-high { background: rgba(237, 137, 54, 0.1); }
        .bg-medium { background: rgba(246, 224, 94, 0.1); }
        .bg-low { background: rgba(104, 211, 145, 0.1); }
        .bg-info { background: rgba(79, 209, 199, 0.1); }


        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-red);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--surface-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            transform: scale(1.1);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-cancel {
            padding: 0.75rem 1.5rem;
            background: var(--accent-bg);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn-cancel:hover {
            background: var(--border-color);
        }

        .btn-primary {
            padding: 0.75rem 1.5rem;
            background: var(--gradient-secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Project Manager Styles */
        .project-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .project-item {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .project-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .project-item-info {
            flex: 1;
        }

        .project-item-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .project-item-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .project-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: rgba(79, 209, 199, 0.2);
            color: var(--accent-blue);
        }

        .btn-edit:hover {
            background: var(--accent-blue);
            color: white;
        }

        .btn-delete {
            background: rgba(252, 129, 129, 0.2);
            color: var(--accent-red);
        }

        .btn-delete:hover {
            background: var(--accent-red);
            color: white;
        }

        @media (max-width: 768px) {
            .project-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .project-actions {
                justify-content: stretch;
            }
            
            .project-select {
                min-width: auto;
                flex: 1;
            }
            
            .project-stats {
                flex-direction: column;
                gap: 0.75rem;
            }
        }

        /* Scan Input Mode Styles */
        .scan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .scan-header h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0;
        }

        .scan-header h3 i {
            color: var(--accent-blue);
        }

        .input-mode-toggle {
            display: flex;
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 0.25rem;
        }

        .mode-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .mode-btn:hover {
            color: var(--accent-blue);
            background: rgba(79, 209, 199, 0.1);
        }

        .mode-btn.active {
            background: var(--gradient-secondary);
            color: white;
        }

        .mode-btn i {
            font-size: 1rem;
        }

        .input-mode {
            margin-bottom: 2rem;
        }

        /* Bulk Input Styles */
        .bulk-input-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .bulk-textarea-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .bulk-label {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bulk-label i {
            color: var(--accent-blue);
        }

        .bulk-textarea {
            width: 100%;
            min-height: 150px;
            max-height: 300px;
            padding: 1rem;
            background: var(--surface-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Courier New', monospace;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .bulk-textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(79, 209, 199, 0.1);
        }

        .bulk-textarea::placeholder {
            color: var(--text-secondary);
            font-family: inherit;
        }

        .bulk-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .target-count {
            color: var(--accent-blue);
            font-weight: 600;
            font-size: 1rem;
        }

        .bulk-actions {
            display: flex;
            gap: 0.75rem;
        }

        .bulk-action-btn {
            padding: 0.5rem 1rem;
            background: var(--accent-bg);
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .bulk-action-btn:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .bulk-scan-btn {
            align-self: flex-start;
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        /* Bulk Progress Styles */
        .bulk-progress-container {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .bulk-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .bulk-progress-title {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .bulk-progress-stats {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .target-progress-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .target-progress-item {
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .target-info {
            flex: 1;
        }

        .target-name {
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .target-status {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .target-progress {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .target-progress-bar {
            width: 100px;
            height: 6px;
            background: var(--accent-bg);
            border-radius: 3px;
            overflow: hidden;
        }

        .target-progress-fill {
            height: 100%;
            background: var(--gradient-secondary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .target-progress-text {
            color: var(--text-secondary);
            font-size: 0.85rem;
            min-width: 40px;
        }

        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .status-pending {
            background: rgba(160, 174, 192, 0.2);
            color: var(--text-secondary);
        }

        .status-running {
            background: rgba(79, 209, 199, 0.2);
            color: var(--accent-blue);
        }

        .status-completed {
            background: rgba(104, 211, 145, 0.2);
            color: var(--accent-green);
        }

        .status-error {
            background: rgba(252, 129, 129, 0.2);
            color: var(--accent-red);
        }

        @media (max-width: 768px) {
            .scan-header {
                flex-direction: column;
                align-items: stretch;
            }

            .input-mode-toggle {
                align-self: center;
            }

            .bulk-info {
                flex-direction: column;
                align-items: stretch;
            }

            .bulk-actions {
                justify-content: center;
            }

            .bulk-scan-btn {
                align-self: stretch;
            }
        }

        /* 개선된 최근 스캔 위젯 스타일 */
        .recent-scans-widget .widget-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .recent-scans-widget .widget-link:hover {
            transform: translateX(2px);
        }

        .recent-scans-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .loading-scans {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 2rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading-scans i {
            color: var(--accent-blue);
        }

        .scan-card {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .scan-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .scan-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-blue);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .scan-card:hover::before {
            opacity: 1;
        }

        .scan-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .scan-target-info {
            flex: 1;
        }

        .scan-target-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .scan-target-ip {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .scan-project-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            border: 1px solid;
            white-space: nowrap;
        }

        .scan-card-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .scan-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            background: var(--primary-bg);
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
        }

        .scan-detail-icon {
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .scan-detail-value {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.125rem;
        }

        .scan-detail-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .scan-detail-item.ports {
            color: var(--accent-blue);
        }

        .scan-detail-item.services {
            color: var(--accent-green);
        }

        .scan-detail-item.vulnerabilities {
            color: var(--accent-red);
        }

        .scan-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .scan-timestamp {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .scan-timestamp i {
            color: var(--accent-blue);
        }

        .scan-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .scan-status-completed {
            background: rgba(104, 211, 145, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(104, 211, 145, 0.3);
        }

        .scan-status-running {
            background: rgba(246, 224, 94, 0.15);
            color: var(--accent-yellow);
            border: 1px solid rgba(246, 224, 94, 0.3);
        }

        .scan-status-error {
            background: rgba(252, 129, 129, 0.15);
            color: var(--accent-red);
            border: 1px solid rgba(252, 129, 129, 0.3);
        }

        .no-scans-message {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .no-scans-message i {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            color: var(--accent-bg);
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- 사이드바 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">CyberScan Pro</div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span class="nav-text">대시보드</span>
                </div>
                <div class="nav-item" data-page="scanner">
                    <i class="fas fa-crosshairs"></i>
                    <span class="nav-text">스캔 실행</span>
                </div>
                <div class="nav-item" data-page="projects">
                    <i class="fas fa-folder"></i>
                    <span class="nav-text">프로젝트 관리</span>
                </div>
                <div class="nav-item" data-page="history">
                    <i class="fas fa-history"></i>
                    <span class="nav-text">스캔 이력</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">설정</span>
                </div>
            </nav>
        </div>

        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <div class="main-header">
                <div class="header-left">
                    <div>
                        <div class="page-title" id="page-title">대시보드</div>
                        <div class="breadcrumb">
                            <i class="fas fa-home"></i>
                            <span id="breadcrumb-text">홈 / 대시보드</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <!-- 대시보드 페이지 -->
                <div class="page-content active" id="dashboard-page">
                    <!-- 프로젝트 선택 섹션 -->
                    <div class="widget-card" style="margin-bottom: 2rem;">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-folder"></i>
                                프로젝트 선택
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <select id="dashboard-project-select" class="form-input" style="min-width: 250px; max-width: 400px; flex: 1;">
                                <option value="">전체 프로젝트</option>
                            </select>
                            <div id="selected-project-info" style="color: var(--text-secondary); font-size: 0.875rem; display: none;">
                                <i class="fas fa-info-circle"></i>
                                <span id="selected-project-details"></span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <!-- 활성 스캔 위젯 -->
                        <div class="widget-card">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-spinner fa-pulse"></i>
                                    활성 스캔
                                </div>
                            </div>
                            <div class="widget-value" id="active-scans-count">2</div>
                            <div class="widget-subtitle">현재 실행 중인 스캔</div>
                        </div>

                        <!-- 완료된 스캔 위젯 -->
                        <div class="widget-card">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-check-circle"></i>
                                    완료된 스캔
                                </div>
                            </div>
                            <div class="widget-value" id="completed-scans-count">125</div>
                            <div class="widget-subtitle">성공적으로 완료</div>
                        </div>

                        <!-- 발견된 포트 위젯 -->
                        <div class="widget-card">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-network-wired"></i>
                                    발견된 포트
                                </div>
                            </div>
                            <div class="widget-value" id="total-ports">1,247</div>
                            <div class="widget-subtitle">열린 포트 총합</div>
                        </div>

                        <!-- 취약점 위젯 -->
                        <div class="widget-card">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    중요 서비스
                                </div>
                            </div>
                            <div class="widget-value" id="critical-services">43</div>
                            <div class="widget-subtitle">보안 주의 필요</div>
                        </div>

                        <!-- 스캔 상태 요약 -->
                        <div class="widget-card scan-status-card">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-chart-pie"></i>
                                    스캔 상태 요약
                                </div>
                            </div>
                            <div class="status-grid">
                                <div class="status-item status-running">
                                    <i class="fas fa-spinner fa-pulse status-icon"></i>
                                    <div class="stat-value">2</div>
                                    <div class="stat-label">실행 중</div>
                                </div>
                                <div class="status-item status-completed">
                                    <i class="fas fa-check-circle status-icon"></i>
                                    <div class="stat-value">125</div>
                                    <div class="stat-label">완료</div>
                                </div>
                                <div class="status-item status-error">
                                    <i class="fas fa-times-circle status-icon"></i>
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">오류</div>
                                </div>
                                <div class="status-item status-pending">
                                    <i class="fas fa-clock status-icon"></i>
                                    <div class="stat-value">0</div>
                                    <div class="stat-label">대기</div>
                                </div>
                            </div>
                        </div>

                        <!-- 최근 스캔 -->
                        <div class="widget-card recent-scans-widget">
                            <div class="widget-header">
                                <div class="widget-title">
                                    <i class="fas fa-history"></i>
                                    최근 스캔
                                </div>
                                <a href="/scan-history" class="widget-link">
                                    <i class="fas fa-external-link-alt"></i>
                                    모두 보기
                                </a>
                            </div>
                            <div class="recent-scans-container">
                                <div class="loading-scans">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>스캔 기록 로딩 중...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 빠른 액션 -->
                    <div class="widget-card">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-bolt"></i>
                                빠른 액션
                            </div>
                        </div>
                        <div class="quick-actions">
                            <div class="action-btn" onclick="showPage('scanner')">
                                <i class="fas fa-play"></i>
                                <div class="action-content">
                                    <div class="action-title">새 스캔 시작</div>
                                    <div class="action-desc">단일 또는 대량 스캔 실행</div>
                                </div>
                            </div>
                            <div class="action-btn" onclick="showPage('projects')">
                                <i class="fas fa-folder-plus"></i>
                                <div class="action-content">
                                    <div class="action-title">프로젝트 생성</div>
                                    <div class="action-desc">새로운 프로젝트 생성</div>
                                </div>
                            </div>
                            <div class="action-btn" onclick="showPage('results')">
                                <i class="fas fa-chart-line"></i>
                                <div class="action-content">
                                    <div class="action-title">결과 분석</div>
                                    <div class="action-desc">스캔 결과 상세 보기</div>
                                </div>
                            </div>
                            <div class="action-btn" onclick="showPage('history')">
                                <i class="fas fa-download"></i>
                                <div class="action-content">
                                    <div class="action-title">보고서 내보내기</div>
                                    <div class="action-desc">스캔 결과 보고서 생성</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>



    <!-- 모달들 -->

    <script>
        let currentScanId = null;
        let progressInterval = null;
        let projects = [];
        let currentProject = null;
        let currentBulkMode = false;
        let currentPage = 'dashboard';
        let selectedDashboardProject = null;

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadProjects();
            initializeSidebar();
            initializeDashboardProjectSelect();
            initializeProjectSelect();
            loadDashboardData();
        });

        // 사이드바 관련 함수들
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        function initializeSidebar() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });
        }

        function showPage(pageId) {
            currentPage = pageId;

            // 스캐너 페이지는 별도 페이지로 이동
            if (pageId === 'scanner') {
                window.location.href = '/scanner';
                return;
            }

            // 프로젝트 관리 페이지는 별도 페이지로 이동  
            if (pageId === 'projects') {
                window.location.href = '/projects';
                return;
            }

            // 스캔 이력 페이지는 별도 페이지로 이동
            if (pageId === 'history') {
                window.location.href = '/scan-history';
                return;
            }

            // 사이드바 활성 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            // 페이지 컨텐츠 표시/숨김
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            const targetPage = document.getElementById(`${pageId}-page`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // 페이지 제목과 breadcrumb 업데이트
            updatePageHeader(pageId);
        }

        function updatePageHeader(pageId) {
            const pageTitle = document.getElementById('page-title');
            const breadcrumbText = document.getElementById('breadcrumb-text');
            
            const pageConfig = {
                'dashboard': { title: '대시보드', breadcrumb: '홈 / 대시보드' },
                'scanner': { title: '스캔 실행', breadcrumb: '홈 / 스캔 실행' },
                'projects': { title: '프로젝트 관리', breadcrumb: '홈 / 프로젝트 관리' },
                'history': { title: '스캔 이력', breadcrumb: '홈 / 스캔 이력' },
                'settings': { title: '설정', breadcrumb: '홈 / 설정' }
            };

            const config = pageConfig[pageId] || pageConfig['dashboard'];
            pageTitle.textContent = config.title;
            breadcrumbText.textContent = config.breadcrumb;
        }

        // 프로젝트 관리 함수들
        function loadProjects() {
            fetch('/api/projects')
            .then(response => response.json())
            .then(data => {
                projects = data;
                updateProjectSelect();
                updateDashboardProjectSelect();
                
                // 첫 번째 프로젝트를 기본으로 선택 (스캐너 페이지용)
                if (projects.length > 0) {
                    selectProject(projects[0].id);
                }
            })
            .catch(error => {
                console.error('프로젝트 로드 실패:', error);
            });
        }

        function updateProjectSelect() {
            const select = document.getElementById('project-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">프로젝트를 선택하세요...</option>';
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                option.style.color = project.color;
                select.appendChild(option);
            });
        }

        function selectProject(projectId) {
            const project = projects.find(p => p.id == projectId);
            if (!project) return;

            currentProject = project;
            const select = document.getElementById('project-select');
            if (select) {
                select.value = projectId;
            }

            // 프로젝트 정보 표시 (스캐너 페이지에서만 사용)
            const projectInfo = document.getElementById('project-info');
            const projectName = document.getElementById('current-project-name');
            const projectDescription = document.getElementById('current-project-description');
            const projectUpdated = document.getElementById('project-updated');
            const projectScans = document.getElementById('project-scans');

            if (projectInfo && projectName && projectDescription && projectUpdated && projectScans) {
                projectName.textContent = project.name;
                projectName.style.color = project.color;
                projectDescription.textContent = project.description || '설명이 없습니다.';
                projectUpdated.textContent = `마지막 업데이트: ${new Date(project.updated_date).toLocaleString()}`;
                projectScans.textContent = `스캔 개수: ${project.scan_count}개`;

                projectInfo.style.display = 'block';
            }
        }

        // 프로젝트 선택 이벤트 (스캐너 페이지용)
        function initializeProjectSelect() {
            const projectSelect = document.getElementById('project-select');
            if (projectSelect) {
                projectSelect.addEventListener('change', function() {
                    const projectId = this.value;
                    if (projectId) {
                        selectProject(projectId);
                    } else {
                        const projectInfo = document.getElementById('project-info');
                        if (projectInfo) {
                            projectInfo.style.display = 'none';
                        }
                        currentProject = null;
                    }
                });
            }
        }

        // 모달 관련 함수들
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
        }

        function showNewProjectModal() {
            document.getElementById('new-project-form').reset();
            showModal('new-project-modal');
        }

        function showProjectManager() {
            loadProjectList();
            showModal('project-manager-modal');
        }

        function loadProjectList() {
            const projectList = document.getElementById('project-list');
            projectList.innerHTML = '';

            projects.forEach(project => {
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.innerHTML = `
                    <div class="project-item-info">
                        <div class="project-item-name" style="color: ${project.color};">${project.name}</div>
                        <div class="project-item-description">${project.description || '설명 없음'} (${project.scan_count}개 스캔)</div>
                    </div>
                    <div class="project-item-actions">
                        <button class="btn-icon btn-edit" onclick="editProject(${project.id})" title="편집">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${project.name !== '기본 프로젝트' ? `
                            <button class="btn-icon btn-delete" onclick="deleteProject(${project.id})" title="삭제">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
                projectList.appendChild(projectItem);
            });
        }

        function editProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;

            document.getElementById('edit-project-id').value = project.id;
            document.getElementById('edit-project-name').value = project.name;
            document.getElementById('edit-project-description').value = project.description || '';
            document.getElementById('edit-project-color').value = project.color;

            closeModal('project-manager-modal');
            showModal('edit-project-modal');
        }

        function deleteProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;

            if (confirm(`'${project.name}' 프로젝트를 삭제하시겠습니까?\n관련된 모든 스캔 결과도 함께 삭제됩니다.`)) {
                fetch(`/api/projects/${projectId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadProjects();
                        closeModal('project-manager-modal');
                    } else {
                        alert('프로젝트 삭제 실패: ' + (data.error || '알 수 없는 오류'));
                    }
                })
                .catch(error => {
                    alert('프로젝트 삭제 실패: ' + error.message);
                });
            }
        }

        // 새 프로젝트 생성 폼 제출
        document.getElementById('new-project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('project-name').value,
                description: document.getElementById('project-description').value,
                color: document.getElementById('project-color').value
            };

            fetch('/api/projects', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    loadProjects();
                    closeModal('new-project-modal');
                } else {
                    alert('프로젝트 생성 실패: ' + (data.error || '알 수 없는 오류'));
                }
            })
            .catch(error => {
                alert('프로젝트 생성 실패: ' + error.message);
            });
        });

        // 프로젝트 편집 폼 제출
        document.getElementById('edit-project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const projectId = document.getElementById('edit-project-id').value;
            const formData = {
                name: document.getElementById('edit-project-name').value,
                description: document.getElementById('edit-project-description').value,
                color: document.getElementById('edit-project-color').value
            };

            fetch(`/api/projects/${projectId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadProjects();
                    closeModal('edit-project-modal');
                } else {
                    alert('프로젝트 수정 실패: ' + (data.error || '알 수 없는 오류'));
                }
            })
            .catch(error => {
                alert('프로젝트 수정 실패: ' + error.message);
            });
        });

        // 모달 외부 클릭 시 닫기
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // 입력 모드 전환 함수
        function switchInputMode(mode) {
            const singleMode = document.getElementById('single-input-mode');
            const bulkMode = document.getElementById('bulk-input-mode');
            const singleBtn = document.getElementById('single-mode-btn');
            const bulkBtn = document.getElementById('bulk-mode-btn');

            if (mode === 'single') {
                singleMode.style.display = 'block';
                bulkMode.style.display = 'none';
                singleBtn.classList.add('active');
                bulkBtn.classList.remove('active');
            } else {
                singleMode.style.display = 'none';
                bulkMode.style.display = 'block';
                singleBtn.classList.remove('active');
                bulkBtn.classList.add('active');
            }
        }

        // 대상 개수 업데이트
        function updateTargetCount() {
            const textarea = document.getElementById('bulk-targets');
            const countElement = document.getElementById('target-count');
            
            const targets = parseTargets(textarea.value);
            countElement.textContent = `${targets.length}개 대상`;
        }

        // 타겟 파싱 함수
        function parseTargets(text) {
            const targets = [];
            
            // 쉼표로 구분된 경우와 줄바꿈으로 구분된 경우 모두 처리
            const lines = text.split(/[\n,]/).map(line => line.trim()).filter(line => line);
            
            for (const line of lines) {
                if (line) {
                    targets.push(line);
                }
            }
            
            return targets;
        }

        // 대량 입력 관련 함수들
        function clearBulkTargets() {
            document.getElementById('bulk-targets').value = '';
            updateTargetCount();
        }

        function loadSampleTargets() {
            const sampleTargets = [
                'google.com',
                'github.com',
                '8.8.8.8',
                'example.com',
                'cloudflare.com'
            ];
            document.getElementById('bulk-targets').value = sampleTargets.join('\n');
            updateTargetCount();
        }

        // 대량 입력 텍스트 변경 이벤트
        document.addEventListener('DOMContentLoaded', function() {
            const bulkTextarea = document.getElementById('bulk-targets');
            if (bulkTextarea) {
                bulkTextarea.addEventListener('input', updateTargetCount);
            }
        });

        function startScan() {
            const domain = document.getElementById('domain-input').value.trim();
            if (!domain) {
                alert('대상 도메인 또는 IP 주소를 입력해주세요.');
                return;
            }

            if (!currentProject) {
                alert('프로젝트를 먼저 선택해주세요.');
                return;
            }

            const scanBtn = document.getElementById('scan-btn');
            const progressContainer = document.getElementById('progress-container');
            const bulkProgressContainer = document.getElementById('bulk-progress-container');
            const resultsContainer = document.getElementById('results-container');

            scanBtn.disabled = true;
            scanBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>스캔 중...</span>';
            progressContainer.style.display = 'block';
            bulkProgressContainer.style.display = 'none';
            resultsContainer.style.display = 'none';

            fetch('/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    targets: [domain],
                    project_id: currentProject.id,
                    bulk_mode: false
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('스캔 시작 실패: ' + data.error);
                    resetUI();
                    return;
                }

                currentScanId = data.scan_id;
                currentBulkMode = false;
                checkProgress();
            })
            .catch(error => {
                alert('스캔 요청 실패: ' + error.message);
                resetUI();
            });
        }

        function startBulkScan() {
            const targets = parseTargets(document.getElementById('bulk-targets').value);
            
            if (targets.length === 0) {
                alert('스캔할 대상을 입력해주세요.');
                return;
            }

            if (!currentProject) {
                alert('프로젝트를 먼저 선택해주세요.');
                return;
            }

            const bulkScanBtn = document.getElementById('bulk-scan-btn');
            const progressContainer = document.getElementById('progress-container');
            const bulkProgressContainer = document.getElementById('bulk-progress-container');
            const resultsContainer = document.getElementById('results-container');

            bulkScanBtn.disabled = true;
            bulkScanBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>대량 스캔 중...</span>';
            progressContainer.style.display = 'none';
            bulkProgressContainer.style.display = 'block';
            resultsContainer.style.display = 'none';

            // 대량 스캔 진행률 초기화
            initBulkProgress(targets);

            fetch('/scan', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    targets: targets,
                    project_id: currentProject.id,
                    bulk_mode: true
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('대량 스캔 시작 실패: ' + data.error);
                    resetUI();
                    return;
                }

                if (data.invalid_targets && data.invalid_targets.length > 0) {
                    alert(`다음 대상들은 유효하지 않아 제외됩니다:\n${data.invalid_targets.join('\n')}`);
                }

                currentScanId = data.scan_id;
                currentBulkMode = true;
                checkProgress();
            })
            .catch(error => {
                alert('대량 스캔 요청 실패: ' + error.message);
                resetUI();
            });
        }

        function initBulkProgress(targets) {
            const targetList = document.getElementById('target-progress-list');
            const bulkStats = document.getElementById('bulk-progress-stats');
            
            targetList.innerHTML = '';
            bulkStats.textContent = `0/${targets.length} 완료`;
            
            targets.forEach(target => {
                const targetItem = document.createElement('div');
                targetItem.className = 'target-progress-item';
                targetItem.id = `target-${target.replace(/[^a-zA-Z0-9]/g, '_')}`;
                targetItem.innerHTML = `
                    <div class="target-info">
                        <div class="target-name">${target}</div>
                        <div class="target-status">대기 중...</div>
                    </div>
                    <div class="target-progress">
                        <div class="target-progress-bar">
                            <div class="target-progress-fill"></div>
                        </div>
                        <div class="target-progress-text">0%</div>
                        <div class="status-icon status-pending">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                `;
                targetList.appendChild(targetItem);
            });
        }

        function updateBulkProgress(scanData) {
            const bulkProgressFill = document.getElementById('bulk-progress-fill');
            const bulkProgressText = document.getElementById('bulk-progress-text');
            const bulkProgressPercentage = document.getElementById('bulk-progress-percentage');
            const bulkStats = document.getElementById('bulk-progress-stats');
            
            // 전체 진행률 업데이트
            const progress = scanData.progress || 0;
            const completedCount = scanData.completed_count || 0;
            const totalCount = scanData.total_count || 0;
            
            bulkProgressFill.style.width = progress + '%';
            bulkProgressText.textContent = getStatusText(scanData.status);
            bulkProgressPercentage.textContent = Math.round(progress) + '%';
            bulkStats.textContent = `${completedCount}/${totalCount} 완료`;
            
            // 개별 타겟 진행률 업데이트
            if (scanData.target_status) {
                Object.entries(scanData.target_status).forEach(([target, status]) => {
                    updateTargetProgress(target, status);
                });
            }
        }

        function updateTargetProgress(target, status) {
            const targetId = `target-${target.replace(/[^a-zA-Z0-9]/g, '_')}`;
            const targetElement = document.getElementById(targetId);
            
            if (!targetElement) return;
            
            const statusElement = targetElement.querySelector('.target-status');
            const progressFill = targetElement.querySelector('.target-progress-fill');
            const progressText = targetElement.querySelector('.target-progress-text');
            const statusIcon = targetElement.querySelector('.status-icon');
            
            // 상태 텍스트 업데이트
            const statusTexts = {
                'pending': '대기 중...',
                'running': '스캔 중...',
                'completed': '완료',
                'error': '오류 발생'
            };
            
            statusElement.textContent = status.error ? 
                `오류: ${status.error}` : statusTexts[status.status] || status.status;
            
            // 진행률 업데이트
            const progress = status.progress || 0;
            progressFill.style.width = progress + '%';
            progressText.textContent = Math.round(progress) + '%';
            
            // 상태 아이콘 업데이트
            statusIcon.className = `status-icon status-${status.status}`;
            const iconMap = {
                'pending': 'fas fa-clock',
                'running': 'fas fa-spinner fa-spin',
                'completed': 'fas fa-check',
                'error': 'fas fa-times'
            };
            statusIcon.innerHTML = `<i class="${iconMap[status.status] || 'fas fa-question'}"></i>`;
        }

        function checkProgress() {
            if (!currentScanId) return;

            progressInterval = setInterval(() => {
                fetch(`/scan/${currentScanId}/status`)
                .then(response => response.json())
                .then(data => {
                    if (currentBulkMode) {
                        updateBulkProgress(data);
                    } else {
                        updateProgress(data.progress || 0, data.status);
                    }

                    if (data.status === 'completed') {
                        clearInterval(progressInterval);
                        loadResults();
                    } else if (data.status === 'error') {
                        clearInterval(progressInterval);
                        alert('스캔 오류: ' + data.error);
                        resetUI();
                    }
                })
                .catch(error => {
                    console.error('진행상황 확인 실패:', error);
                });
            }, 2000);
        }

        function updateProgress(progress, status) {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const progressPercentage = document.getElementById('progress-percentage');

            progressFill.style.width = progress + '%';
            progressText.textContent = getStatusText(status);
            progressPercentage.textContent = Math.round(progress) + '%';
        }

        function getStatusText(status) {
            const statusTexts = {
                'started': '스캔 초기화 중...',
                'running': '보안 취약점 스캔 중...',
                'analyzing': '결과 분석 중...',
                'completed': '스캔 완료'
            };
            return statusTexts[status] || status;
        }

        function loadResults() {
            fetch(`/scan/${currentScanId}/results`)
            .then(response => response.json())
            .then(data => {
                displayResults(data);
                resetUI();
                document.getElementById('results-container').style.display = 'block';
                
                // 스캔 완료 후 프로젝트 정보 새로고침
                loadProjects();
            })
            .catch(error => {
                alert('결과 로드 실패: ' + error.message);
                resetUI();
            });
        }

        function displayResults(results) {
            const resultsContent = document.getElementById('results-content');
            resultsContent.innerHTML = '';

            for (const [hostname, data] of Object.entries(results)) {
                const hostDiv = createHostResult(hostname, data);
                resultsContent.appendChild(hostDiv);
            }
        }

        function createHostResult(hostname, data) {
            const hostDiv = document.createElement('div');
            hostDiv.className = 'host-result';

            const headerDiv = document.createElement('div');
            headerDiv.className = 'host-header';
            headerDiv.innerHTML = `
                <div>
                    <span class="host-title">${hostname}</span>
                    <span class="host-ip">(${data.ip || 'IP 없음'})</span>
                </div>
                <i class="fas fa-chevron-down expand-icon"></i>
            `;
            headerDiv.onclick = () => toggleHostContent(hostDiv);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'host-content';
            
            const infoGrid = document.createElement('div');
            infoGrid.className = 'info-grid';

            // FastNmap 스캔 요약
            if (data.scan_summary) {
                infoGrid.appendChild(createScanSummarySection(data));
            }

            // 포트 정보
            infoGrid.appendChild(createInfoSection('포트 스캔 결과', data.ports || [], 'ports'));
            
            // 서비스 정보
            infoGrid.appendChild(createInfoSection('검출된 서비스', data.services || [], 'services'));

            contentDiv.appendChild(infoGrid);
            hostDiv.appendChild(headerDiv);
            hostDiv.appendChild(contentDiv);

            return hostDiv;
        }

        function createInfoSection(title, items, type) {
            const section = document.createElement('div');
            section.className = 'info-section';

            const icons = {
                'ports': 'fas fa-network-wired',
                'services': 'fas fa-cogs',
                'cves': 'fas fa-bug',
                'poc': 'fas fa-code'
            };

            const header = document.createElement('h4');
            header.innerHTML = `<i class="${icons[type] || 'fas fa-info-circle'}"></i>${title}`;
            section.appendChild(header);

            if (items.length === 0) {
                const noData = document.createElement('p');
                noData.textContent = '검출된 정보가 없습니다.';
                noData.className = 'text-secondary';
                section.appendChild(noData);
                return section;
            }

            items.forEach(item => {
                const itemDiv = document.createElement('div');
                
                if (type === 'ports') {
                    itemDiv.className = `info-item ${item.state === 'open' ? 'low' : ''}`;
                    itemDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong>포트 ${item.port}/${item.protocol}</strong>
                            <span class="status-badge status-${item.state}">${item.state}</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-top: 0.5rem;">
                            서비스: ${item.service}
                            ${item.scan_method ? `<br>스캔 방식: ${item.scan_method}` : ''}
                        </div>
                    `;
                } else if (type === 'services') {
                    itemDiv.className = 'info-item';
                    itemDiv.innerHTML = `
                        <strong>${item.service}</strong> <span style="color: var(--text-secondary);">(포트 ${item.port})</span>
                        <br>버전: ${item.version || 'Unknown'}
                        ${item.scan_method ? `<br>탐지 방식: ${item.scan_method}` : ''}
                    `;
                }
                
                section.appendChild(itemDiv);
            });

            return section;
        }

        function createScanSummarySection(data) {
            const section = document.createElement('div');
            section.className = 'info-section';

            const header = document.createElement('h4');
            header.innerHTML = '<i class="fas fa-chart-line"></i>FastNmap 스캔 요약';
            section.appendChild(header);

            const summary = data.scan_summary;

            if (!summary) {
                const noData = document.createElement('p');
                noData.textContent = '스캔 요약 정보를 사용할 수 없습니다.';
                noData.className = 'text-secondary';
                section.appendChild(noData);
                return section;
            }

            // 기본 스캔 정보
            const basicInfo = document.createElement('div');
            basicInfo.className = 'info-item';
            basicInfo.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <strong><i class="fas fa-search"></i> ${data.scan_method || 'FastNmap 2-Stage'}</strong>
                    <span class="status-badge status-${summary.status === 'completed' ? 'open' : 'closed'}">${summary.status?.toUpperCase() || 'UNKNOWN'}</span>
                </div>
                <div class="scan-stats">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 0.5rem 0;">
                        <div>
                            <i class="fas fa-clock"></i> <strong>스캔 시간:</strong> ${data.scan_time || 'Unknown'}
                        </div>
                        <div>
                            <i class="fas fa-network-wired"></i> <strong>대상 IP:</strong> ${data.ip || 'Unknown'}
                        </div>
                        <div>
                            <i class="fas fa-door-open"></i> <strong>열린 포트:</strong> ${data.open_ports_count || 0}개
                        </div>
                        <div>
                            <i class="fas fa-search"></i> <strong>총 스캔 포트:</strong> ${data.total_ports_scanned || 0}개
                        </div>
                    </div>
                </div>
            `;
            section.appendChild(basicInfo);

            // 포트 요약
            if (summary.open_ports && summary.open_ports.length > 0) {
                const portsDiv = document.createElement('div');
                portsDiv.className = 'info-item';
                portsDiv.innerHTML = `
                    <div style="margin-bottom: 0.75rem;">
                        <strong><i class="fas fa-list"></i> 열린 포트 목록</strong>
                        <span style="color: var(--text-secondary); font-size: 0.875rem; margin-left: 0.5rem;">
                            (${summary.open_ports.length}개 발견)
                        </span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                        ${summary.open_ports.map(port => `<span class="status-badge status-open">${port}</span>`).join('')}
                    </div>
                `;
                section.appendChild(portsDiv);
            }

            // 중요 서비스
            if (summary.critical_services && summary.critical_services.length > 0) {
                const criticalDiv = document.createElement('div');
                criticalDiv.className = 'info-item high';
                criticalDiv.innerHTML = `
                    <div style="margin-bottom: 0.75rem;">
                        <strong><i class="fas fa-exclamation-triangle"></i> 중요 서비스</strong>
                        <span style="color: var(--text-secondary); font-size: 0.875rem; margin-left: 0.5rem;">
                            (보안 주의 필요)
                        </span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                        ${summary.critical_services.map(service => `<span class="status-badge">${service}</span>`).join('')}
                    </div>
                `;
                section.appendChild(criticalDiv);
            }

            // 웹 서비스
            if (summary.web_services && summary.web_services.length > 0) {
                const webDiv = document.createElement('div');
                webDiv.className = 'info-item';
                webDiv.innerHTML = `
                    <div style="margin-bottom: 0.75rem;">
                        <strong><i class="fas fa-globe"></i> 웹 서비스</strong>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                        ${summary.web_services.map(service => `<span class="status-badge status-open">${service}</span>`).join('')}
                    </div>
                `;
                section.appendChild(webDiv);
            }

            // 일반 서비스
            if (summary.common_services && summary.common_services.length > 0) {
                const commonDiv = document.createElement('div');
                commonDiv.className = 'info-item';
                commonDiv.innerHTML = `
                    <div style="margin-bottom: 0.75rem;">
                        <strong><i class="fas fa-cogs"></i> 일반 서비스</strong>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                        ${summary.common_services.map(service => `<span class="status-badge">${service}</span>`).join('')}
                    </div>
                `;
                section.appendChild(commonDiv);
            }

            return section;
        }

        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function toggleHostContent(hostDiv) {
            const content = hostDiv.querySelector('.host-content');
            const icon = hostDiv.querySelector('.expand-icon');
            
            if (content.style.display === 'block') {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-down expand-icon';
            } else {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-up expand-icon';
            }
        }

        function resetUI() {
            const scanBtn = document.getElementById('scan-btn');
            const bulkScanBtn = document.getElementById('bulk-scan-btn');
            const progressContainer = document.getElementById('progress-container');
            const bulkProgressContainer = document.getElementById('bulk-progress-container');

            if (scanBtn) {
                scanBtn.disabled = false;
                scanBtn.innerHTML = '<i class="fas fa-play"></i><span>스캔 시작</span>';
            }

            if (bulkScanBtn) {
                bulkScanBtn.disabled = false;
                bulkScanBtn.innerHTML = '<i class="fas fa-rocket"></i><span>대량 스캔 시작</span>';
            }

            progressContainer.style.display = 'none';
            bulkProgressContainer.style.display = 'none';
            currentScanId = null;
            currentBulkMode = false;

            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }

        // 대시보드 프로젝트 선택 관련 함수들
        function initializeDashboardProjectSelect() {
            const dashboardSelect = document.getElementById('dashboard-project-select');
            if (dashboardSelect) {
                dashboardSelect.addEventListener('change', function() {
                    const projectId = this.value;
                    if (projectId) {
                        selectedDashboardProject = projects.find(p => p.id == projectId);
                    } else {
                        selectedDashboardProject = null;
                    }
                    updateDashboardProjectInfo();
                    loadDashboardData();
                });
            }
        }

        function updateDashboardProjectSelect() {
            const dashboardSelect = document.getElementById('dashboard-project-select');
            if (!dashboardSelect) return;

            // 기존 옵션 제거 (첫 번째 옵션 제외)
            while (dashboardSelect.children.length > 1) {
                dashboardSelect.removeChild(dashboardSelect.lastChild);
            }
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                option.style.color = project.color;
                dashboardSelect.appendChild(option);
            });
        }

        function updateDashboardProjectInfo() {
            const infoDiv = document.getElementById('selected-project-info');
            const detailsSpan = document.getElementById('selected-project-details');
            
            if (selectedDashboardProject) {
                detailsSpan.textContent = `${selectedDashboardProject.description || '설명 없음'} | ${selectedDashboardProject.scan_count || 0}개 스캔`;
                infoDiv.style.display = 'flex';
                infoDiv.style.alignItems = 'center';
                infoDiv.style.gap = '0.5rem';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function loadDashboardData() {
            loadDashboardStats();
            loadRecentScans();
        }

        function loadDashboardStats() {
            const apiUrl = selectedDashboardProject 
                ? `/api/projects/${selectedDashboardProject.id}/stats`
                : '/api/dashboard/stats';
            
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                updateDashboardWidgets(data);
            })
            .catch(error => {
                console.error('대시보드 통계 로드 실패:', error);
                // 기본값으로 폴백
                updateDashboardWidgets({
                    active_scans: 0,
                    completed_scans: 0,
                    total_ports: 0,
                    critical_services: 0,
                    running_scans: 0,
                    error_scans: 0,
                    pending_scans: 0
                });
            });
        }

        function updateDashboardWidgets(data) {
            // 위젯 값 업데이트
            const activeScansCount = document.getElementById('active-scans-count');
            const completedScansCount = document.getElementById('completed-scans-count');
            const totalPorts = document.getElementById('total-ports');
            const criticalServices = document.getElementById('critical-services');
            
            if (activeScansCount) activeScansCount.textContent = data.active_scans || 0;
            if (completedScansCount) completedScansCount.textContent = data.completed_scans || 0;
            if (totalPorts) totalPorts.textContent = (data.total_ports || 0).toLocaleString();
            if (criticalServices) criticalServices.textContent = data.critical_services || 0;

            // 헤더 통계 업데이트
            const totalScansElement = document.getElementById('total-scans');
            if (totalScansElement) {
                totalScansElement.textContent = (data.completed_scans || 0) + (data.active_scans || 0);
            }

            // 상태 그리드 업데이트
            updateStatusGrid(data);
        }

        function updateStatusGrid(data) {
            const statusItems = document.querySelectorAll('.status-grid .status-item .stat-value');
            if (statusItems.length >= 4) {
                statusItems[0].textContent = data.running_scans || 0;  // 실행 중
                statusItems[1].textContent = data.completed_scans || 0; // 완료
                statusItems[2].textContent = data.error_scans || 0;     // 오류
                statusItems[3].textContent = data.pending_scans || 0;   // 대기
            }
        }

        function loadRecentScans() {
            const apiUrl = selectedDashboardProject 
                ? `/api/projects/${selectedDashboardProject.id}/recent-scans`
                : '/api/dashboard/recent-scans';
            
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                updateRecentScansList(data.scans || []);
            })
            .catch(error => {
                console.error('최근 스캔 로드 실패:', error);
                updateRecentScansList([]);
            });
        }

        function updateRecentScansList(scans) {
            const recentScansContainer = document.querySelector('.recent-scans-container');
            if (!recentScansContainer) return;

            if (scans.length === 0) {
                recentScansContainer.innerHTML = `
                    <div class="no-scans-message">
                        <i class="fas fa-search"></i>
                        <p>아직 스캔 기록이 없습니다.</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">스캐너에서 첫 번째 스캔을 실행해보세요!</p>
                    </div>
                `;
                return;
            }

            recentScansContainer.innerHTML = '';

            scans.slice(0, 4).forEach(scan => {
                const scanCard = createScanCard(scan);
                recentScansContainer.appendChild(scanCard);
            });
        }

        function createScanCard(scan) {
            const scanCard = document.createElement('div');
            scanCard.className = 'scan-card';
            scanCard.onclick = () => showScanDetailFromDashboard(scan);

            const timeAgo = getTimeAgo(scan.scan_date);
            const project = projects.find(p => p.id == (scan.project_id || 1));
            const projectName = project ? project.name : '기본 프로젝트';
            const projectColor = project ? project.color : '#4fd1c7';

            // JSON 파싱으로 실제 데이터 추출
            let portsCount = 0;
            let servicesCount = 0;
            let vulnsCount = 0;

            try {
                const ports = typeof scan.ports === 'string' ? JSON.parse(scan.ports) : (scan.ports || []);
                const services = typeof scan.services === 'string' ? JSON.parse(scan.services) : (scan.services || []);
                const vulns = typeof scan.vulnerabilities === 'string' ? JSON.parse(scan.vulnerabilities) : (scan.vulnerabilities || []);
                
                portsCount = ports.length || scan.ports_count || 0;
                servicesCount = services.length || 0;
                vulnsCount = vulns.length || 0;
            } catch (e) {
                portsCount = scan.ports_count || 0;
            }

            const targetName = scan.domain || scan.subdomain || scan.ip_address || 'Unknown';
            const targetIP = scan.ip_address && scan.domain ? scan.ip_address : '';

            scanCard.innerHTML = `
                <div class="scan-card-header">
                    <div class="scan-target-info">
                        <div class="scan-target-name">${targetName}</div>
                        ${targetIP ? `<div class="scan-target-ip">${targetIP}</div>` : ''}
                    </div>
                    <span class="scan-project-badge" style="color: ${projectColor}; border-color: ${projectColor};">
                        ${projectName}
                    </span>
                </div>

                <div class="scan-card-details">
                    <div class="scan-detail-item ports">
                        <i class="fas fa-network-wired scan-detail-icon"></i>
                        <div class="scan-detail-value">${portsCount}</div>
                        <div class="scan-detail-label">포트</div>
                    </div>
                    <div class="scan-detail-item services">
                        <i class="fas fa-cogs scan-detail-icon"></i>
                        <div class="scan-detail-value">${servicesCount}</div>
                        <div class="scan-detail-label">서비스</div>
                    </div>
                    <div class="scan-detail-item vulnerabilities">
                        <i class="fas fa-shield-alt scan-detail-icon"></i>
                        <div class="scan-detail-value">${vulnsCount}</div>
                        <div class="scan-detail-label">취약점</div>
                    </div>
                </div>

                <div class="scan-card-footer">
                    <div class="scan-timestamp">
                        <i class="fas fa-clock"></i>
                        <span>${timeAgo}</span>
                    </div>
                    <span class="scan-status-badge scan-status-completed">완료</span>
                </div>
            `;

            return scanCard;
        }

        function showScanDetailFromDashboard(scan) {
            // 스캔 이력 페이지로 이동하거나 모달 표시
            window.open('/scan-history', '_blank');
        }

        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return '방금 전';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}분 전`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}시간 전`;
            return `${Math.floor(diffInSeconds / 86400)}일 전`;
        }

        function getStatusClass(status) {
            const statusMap = {
                'completed': 'status-open',
                'running': 'status-running',
                'error': 'status-closed',
                'pending': 'status-pending'
            };
            return statusMap[status] || 'status-open';
        }

        function getStatusText(status) {
            const statusMap = {
                'completed': '완료',
                'running': '실행중',
                'error': '오류',
                'pending': '대기'
            };
            return statusMap[status] || '완료';
        }

        // Enter 키로 스캔 시작
        const domainInput = document.getElementById('domain-input');
        if (domainInput) {
            domainInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startScan();
                }
            });
        }

    </script>
</body>
</html>